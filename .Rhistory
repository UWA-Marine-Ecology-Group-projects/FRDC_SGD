class(v1)
v1[1]$id
varsize <- v1$varsize
varsize # 285  725 9763
class(varsize)
ndims   <- v1$ndims
ndims # 3
class(ndims)
nt      <- varsize[ndims]
nt # 9763
lats <- ncvar_get(file,'lat')
head(lats)
dim(lats) # 285
class(lats) # array
# make data frame
library(data.table) # this works well
lat <- as.data.frame.table(lats)
head(lat)
str(lat)
lons <- ncvar_get(file,'lon')
head(lons) # 725
class(lons) # array
# make data frame
lon <- as.data.frame.table(lons)
head(lon)
str(lon)
time <- ncvar_get(file,'time')
time # check the time format
head(time)
dim(time) #9763
class(time) # array
tunits <- ncatt_get(file,"time","units")
tunits # check units : seconds since 1981-01-01 00:00:00
class(tunits) # "list"
nt <- dim(time)
nt # 9763
# change to actual date --
t <- as.data.frame(as.POSIXlt(time, origin = '1981-01-01 00:00:00'))
class(t)
# make data frame
#t <- as.data.frame.table(time2)
head(t)
str(t)
# get global attributes of net cdf
title <- ncatt_get(file, 0, "title")
institution <- ncatt_get(file, 0, "institution")
datasource <- ncatt_get(file, 0, "source")
references <- ncatt_get(file, 0, "references")
history <- ncatt_get(file, 0, "history")
Conventions <- ncatt_get(file, 0, "Conventions")
### CLOSE NETCFD FILE!
nc_close(file)
#### at this point I start extracting the SST as time fragments and saving as dataframe to later join them
file <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/')) # open netcdf file
SST <- file$var[[1]] # object the sst variable
# choose the time frame you want to download
start <- c(1,1,1)
count <- c(2,1,12) ## gonna start with only 5 time steps
test <- ncvar_get(file, SST)
test
#### at this point I start extracting the SST as time fragments and saving as dataframe to later join them
file <- nc_open(paste(dr.dir, 'IMOS_aggregation_20210601T022602Z.nc', sep='/')) # open netcdf file
SST <- file$var[[1]] # object the sst variable
# choose the time frame you want to download
start <- c(1,1,1)
count <- c(2,1,12) ## gonna start with only 5 time steps
test <- ncvar_get(file, SST)
test
#require(R.matlab)
library(R.matlab)
library(maptools)
library(raster)
library(rgdal)
library(sp)
file <- paste(dr.dir, 'SST_cervantes_multi.nc', sep='/')
file
file2 <- brick(file)
install.packages("ncdump")
library(ncdump)
md <- ncdump::NetCDF(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
ncfile$nvars
ncfile$var
ncfile$var[[1]]
ncfile$var[[1]]
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
md <- ncdump::NetCDF(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
rm(list=ls())
md <- ncdump::NetCDF(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
# Directories ----
w.dir <- dirname(rstudioapi::getActiveDocumentContext()$path)
p.dir <- paste(w.dir, "plots", sep = '/')
dr.dir <- paste(w.dir, "data/raw", sep='/')
dt.dir <- paste(w.dir, "data/tidy", sep='/')
s.dir <- paste(w.dir, "data/spatial", sep ='/')
md <- ncdump::NetCDF(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
md <- ncdump::NetCDF(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
md
# Directories ----
w.dir <- dirname(rstudioapi::getActiveDocumentContext()$path)
p.dir <- paste(w.dir, "plots", sep = '/')
dr.dir <- paste(w.dir, "data/raw", sep='/')
dt.dir <- paste(w.dir, "data/tidy", sep='/')
s.dir <- paste(w.dir, "data/spatial", sep ='/')
md <- ncdump::NetCDF(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_cervantes_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
nc_close(ncfile)
md <- ncdump::NetCDF(paste(dr.dir, 'SST_mindarie_multi.nc', sep='/'))
ncfile <- nc_open(paste(dr.dir, 'SST_mindarie_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
nc_close(ncfile)
ncfile <- nc_open(paste(dr.dir, 'SST_marmion_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
md <- ncdump::NetCDF(paste(dr.dir, 'SST_tworocks_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_tworocks_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
sst$varsize
v1 <- file$var[[1]]
v1 <- ncfile$var[[1]]
v1 # also SST
class(v1)
varsize <- v1$varsize
varsize
id <- v1$id
id
time2 <- as.data.frame(as.POSIXlt(time, origin = '1981-01-01 00:00:00'))
time2
date <- as.data.frame(as.POSIXlt(time, origin = '1981-01-01 00:00:00'))
date
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as.tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 24)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 24)) %>% select(time, lon,lat, sst)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 24)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
library(dplyr)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 24)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
library(tidyverse)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 24)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
varsize
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 18)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 18)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:24) %>%
mutate(time = date[i], lat = rep(lat, each = 18)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 7)) %>% select(time, lon,lat, sst)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 7)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 90)) %>% select(time, lon,lat, sst)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:18) %>%
mutate(time = date[i], lat = rep(lat, each = 90)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
varsize
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 1:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as.tibble() %>%
gather(key = "key", value = "sst", 1:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as.tibble() %>%
gather(key = "key", value = "sst", 1:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as.tibble() %>%
gather(key = "key", value = "sst", 2:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
tidyverse::as_tibble() %>%
tidyverse::gather(key = "key", value = "sst", 2:6) %>%
tidyverse::mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
tidyverse::gather(key = "key", value = "sst", 2:6) %>%
tidyverse::mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon,sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:6) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
sst.df
ssta
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())
ssta
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble()
ssta
varsize
# read potential natural vegetation data sage_veg30.nc:
# modify the following path to reflect local files
vegtype_path <- dr.dir
vegtype_name <- "SST_tworocks_multi.nc"
vegtype_file <- paste(vegtype_path, vegtype_name, sep="")
vegtype <- raster(vegtype_file, varname="vegtype")
vegtype_file <- paste(vegtype_path, vegtype_name, sep="/")
vegtype <- raster(vegtype_file, varname="vegtype")
vegtype <- raster(vegtype_file, varname="sea_surface_temperature")
plot(vegtype)
vegtype_name <- "SST_marmion_multi.nc"
vegtype_file <- paste(vegtype_path, vegtype_name, sep="/")
vegtype <- raster(vegtype_file, varname="sea_surface_temperature")
plot(vegtype)
vegtype_name <- "SST_mindarie_multi.nc"
vegtype_file <- paste(vegtype_path, vegtype_name, sep="/")
vegtype <- raster(vegtype_file, varname="sea_surface_temperature")
plot(vegtype)
vegtype_name <- "SST_cervantes_multi.nc"
vegtype_file <- paste(vegtype_path, vegtype_name, sep="/")
vegtype <- raster(vegtype_file, varname="sea_surface_temperature")
plot(vegtype)
vegtype
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(key = "key", value = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
ssta
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18)
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
rm(list=ls())
# libraries ----
library(ncdf4)
library(raster)
library(chron)
library(data.table) # for as.data.frame.table function
library(plyr) # for adply function to turn array into df
library(readr) # for Rds files
library(gapfill) # to convert arrays to raster
library(lubridate) # to convert dates
library(ncdump)
library(dplyr)
library(tidyverse)
rm(list=ls())
# Directories ----
w.dir <- dirname(rstudioapi::getActiveDocumentContext()$path)
p.dir <- paste(w.dir, "plots", sep = '/')
dr.dir <- paste(w.dir, "data/raw", sep='/')
dt.dir <- paste(w.dir, "data/tidy", sep='/')
s.dir <- paste(w.dir, "data/spatial", sep ='/')
md <- ncdump::NetCDF(paste(dr.dir, 'SST_tworocks_multi.nc', sep='/'))
md
ncfile <- nc_open(paste(dr.dir, 'SST_tworocks_multi.nc', sep='/'))
lat <- ncvar_get(ncfile, "lat")
lon <- ncvar_get(ncfile, "lon")
time <- ncvar_get(ncfile, "time")
date <- as.data.frame(as.POSIXlt(time, origin = '1981-01-01 00:00:00'))
date
ncfile$var$sea_surface_temperature
sst <- ncvar_get(ncfile, "sea_surface_temperature")
sst
v1 <- ncfile$var[[1]]
v1 # also SST
class(v1)
varsize <- v1$varsize
varsize
id <- v1$id
nc_close(ncfile)
## sea surface temp
sst.df = NULL
for (i in 1:length(date)) {
ssta = data.frame(lon, sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18) %>%
mutate(time = date[i], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
1:length(date)
length(date)
length(time)
date[1]
date[1,]
## sea surface temp
sst.df = NULL
for (i in 1:length(time)) {
ssta = data.frame(lon, sst[,,i] %>% as.data.frame())%>%
as_tibble() %>%
#gather(key = "key", value = "sst", 2:18) %>%
pivot_longer(ssta, values_to = "sst", 2:18) %>%
mutate(time = date[i,], lat = rep(lat, each = 17)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
time[1]
sst[,,1]
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble()
ssta
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:17)
ssta
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:17) %>%
#pivot_longer(ssta, values_to = "sst", 1:17) %>%
mutate(time = date[1,], lat = rep(lat, each = 17))
varsize
for (i in 1:length(time)) {
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:17) %>%
#pivot_longer(ssta, values_to = "sst", 1:17) %>%
mutate(time = date[1,], lat = rep(lat, each = 5))
ssta
for (i in 1:length(time)) {
ssta = data.frame(lon, sst[,,1] %>% as.data.frame())%>%
as_tibble() %>%
gather(key = "key", value = "sst", 2:17) %>%
#pivot_longer(ssta, values_to = "sst", 1:17) %>%
mutate(time = date[1,], lat = rep(lat, each = 5)) %>% select(time, lon,lat, sst)
sst.df = sst.df %>% bind_rows(ssta)
}
## sea surface temp
sst.df = NULL
